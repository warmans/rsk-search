{
  "swagger": "2.0",
  "info": {
    "title": "search.proto",
    "version": "1.0"
  },
  "tags": [
    {
      "name": "SearchService"
    }
  ],
  "schemes": [
    "http"
  ],
  "consumes": [
    "application/json"
  ],
  "produces": [
    "application/json"
  ],
  "paths": {
    "/api/changelog": {
      "get": {
        "summary": "Fetch list of changelogs",
        "operationId": "listChangelogs",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/rskChangelogList"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "filter",
            "in": "query",
            "required": false,
            "type": "string"
          },
          {
            "name": "sortField",
            "in": "query",
            "required": false,
            "type": "string"
          },
          {
            "name": "sortDirection",
            "in": "query",
            "required": false,
            "type": "string"
          },
          {
            "name": "page",
            "in": "query",
            "required": false,
            "type": "integer",
            "format": "int32"
          },
          {
            "name": "pageSize",
            "in": "query",
            "required": false,
            "type": "integer",
            "format": "int32"
          }
        ],
        "tags": [
          "search"
        ]
      }
    },
    "/api/metadata": {
      "get": {
        "summary": "Search related metadata (searchable fields, available publications etc.)",
        "operationId": "getMetadata",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/rskMetadata"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "tags": [
          "search"
        ]
      }
    },
    "/api/search": {
      "get": {
        "summary": "Perform a search",
        "operationId": "search",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/rskSearchResultList"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "query",
            "in": "query",
            "required": false,
            "type": "string"
          },
          {
            "name": "page",
            "in": "query",
            "required": false,
            "type": "integer",
            "format": "int32"
          }
        ],
        "tags": [
          "search"
        ]
      }
    },
    "/api/search/predict-terms": {
      "get": {
        "summary": "Predict the search term being typed similar to auto-complete.",
        "operationId": "predictSearchTerm",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/rskSearchTermPredictions"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "prefix",
            "in": "query",
            "required": false,
            "type": "string"
          },
          {
            "name": "maxPredictions",
            "in": "query",
            "required": false,
            "type": "integer",
            "format": "int32"
          },
          {
            "name": "query",
            "in": "query",
            "required": false,
            "type": "string"
          },
          {
            "name": "exact",
            "in": "query",
            "required": false,
            "type": "boolean"
          }
        ],
        "tags": [
          "search"
        ]
      }
    },
    "/api/values/{field}": {
      "get": {
        "summary": "Get a list of values for the given keyword field",
        "operationId": "listFieldValues",
        "responses": {
          "200": {
            "description": "A successful response.",
            "schema": {
              "$ref": "#/definitions/rskFieldValueList"
            }
          },
          "default": {
            "description": "An unexpected error response.",
            "schema": {
              "$ref": "#/definitions/rpcStatus"
            }
          }
        },
        "parameters": [
          {
            "name": "field",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "prefix",
            "in": "query",
            "required": false,
            "type": "string"
          }
        ],
        "tags": [
          "search"
        ]
      }
    }
  },
  "definitions": {
    "FieldMetaKind": {
      "type": "string",
      "enum": [
        "UNKNOWN",
        "IDENTIFIER",
        "KEYWORD",
        "KEYWORD_LIST",
        "TEXT",
        "INT",
        "FLOAT",
        "DATE"
      ],
      "default": "UNKNOWN"
    },
    "protobufAny": {
      "type": "object",
      "properties": {
        "typeUrl": {
          "type": "string"
        },
        "value": {
          "type": "string",
          "format": "byte"
        }
      }
    },
    "rpcStatus": {
      "type": "object",
      "properties": {
        "code": {
          "type": "integer",
          "format": "int32"
        },
        "message": {
          "type": "string"
        },
        "details": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/protobufAny"
          }
        }
      }
    },
    "rskAudioQuality": {
      "type": "string",
      "enum": [
        "UNKNOWN",
        "POOR",
        "AVERAGE",
        "GOOD"
      ],
      "default": "UNKNOWN"
    },
    "rskChangelog": {
      "type": "object",
      "properties": {
        "date": {
          "type": "string"
        },
        "content": {
          "type": "string"
        }
      }
    },
    "rskChangelogList": {
      "type": "object",
      "properties": {
        "changelogs": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/rskChangelog"
          }
        }
      }
    },
    "rskDialog": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "pos": {
          "type": "integer",
          "format": "int32"
        },
        "type": {
          "type": "string"
        },
        "actor": {
          "type": "string"
        },
        "content": {
          "type": "string"
        },
        "metadata": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "isMatchedRow": {
          "type": "boolean"
        },
        "notable": {
          "type": "boolean"
        },
        "offsetSec": {
          "type": "string",
          "format": "int64"
        },
        "offsetInferred": {
          "type": "boolean"
        }
      }
    },
    "rskDialogResult": {
      "type": "object",
      "properties": {
        "transcript": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/rskDialog"
          }
        },
        "score": {
          "type": "number",
          "format": "float"
        }
      }
    },
    "rskFieldMeta": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "kind": {
          "$ref": "#/definitions/FieldMetaKind"
        }
      }
    },
    "rskFieldValue": {
      "type": "object",
      "properties": {
        "value": {
          "type": "string"
        },
        "count": {
          "type": "integer",
          "format": "int32"
        }
      }
    },
    "rskFieldValueList": {
      "type": "object",
      "properties": {
        "values": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/rskFieldValue"
          }
        }
      }
    },
    "rskMetadata": {
      "type": "object",
      "properties": {
        "searchFields": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/rskFieldMeta"
          }
        },
        "episodeShortIds": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "rskPrediction": {
      "type": "object",
      "properties": {
        "line": {
          "type": "string"
        },
        "fragment": {
          "type": "string"
        },
        "epid": {
          "type": "string"
        },
        "pos": {
          "type": "integer",
          "format": "int32"
        },
        "actor": {
          "type": "string"
        }
      }
    },
    "rskSearchResult": {
      "type": "object",
      "properties": {
        "episode": {
          "$ref": "#/definitions/rskShortTranscript"
        },
        "dialogs": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/rskDialogResult"
          }
        }
      }
    },
    "rskSearchResultList": {
      "type": "object",
      "properties": {
        "results": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/rskSearchResult"
          }
        },
        "resultCount": {
          "type": "integer",
          "format": "int32"
        },
        "stats": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/definitions/rskSearchStats"
          }
        }
      }
    },
    "rskSearchStats": {
      "type": "object",
      "properties": {
        "labels": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "values": {
          "type": "array",
          "items": {
            "type": "number",
            "format": "float"
          }
        }
      }
    },
    "rskSearchTermPredictions": {
      "type": "object",
      "properties": {
        "prefix": {
          "type": "string"
        },
        "predictions": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/rskPrediction"
          }
        }
      }
    },
    "rskShortTranscript": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "publication": {
          "type": "string"
        },
        "series": {
          "type": "integer",
          "format": "int32"
        },
        "episode": {
          "type": "integer",
          "format": "int32"
        },
        "transcriptAvailable": {
          "type": "boolean"
        },
        "incomplete": {
          "type": "boolean"
        },
        "releaseDate": {
          "type": "string"
        },
        "summary": {
          "type": "string"
        },
        "synopsis": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/rskSynopsis"
          }
        },
        "triviaAvailable": {
          "type": "boolean"
        },
        "actors": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "audioUri": {
          "type": "string"
        },
        "shortId": {
          "type": "string"
        },
        "offsetAccuracyPcnt": {
          "type": "integer",
          "format": "int32"
        },
        "name": {
          "type": "string"
        },
        "version": {
          "type": "string"
        },
        "metadata": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "bestof": {
          "type": "boolean"
        },
        "special": {
          "type": "boolean"
        },
        "audioQuality": {
          "$ref": "#/definitions/rskAudioQuality"
        }
      }
    },
    "rskSynopsis": {
      "type": "object",
      "properties": {
        "description": {
          "type": "string"
        },
        "startPos": {
          "type": "integer",
          "format": "int32"
        },
        "endPos": {
          "type": "integer",
          "format": "int32"
        }
      }
    }
  },
  "externalDocs": {
    "description": "Search transcriptions",
    "url": "https://scrimpton.com"
  }
}
